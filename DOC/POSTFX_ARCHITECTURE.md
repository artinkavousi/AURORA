# ğŸ¨ Post-FX System Architecture

## System Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FlowApp (APP.ts)                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Initialization                          â”‚  â”‚
â”‚  â”‚  1. Load config with post-FX parameters                   â”‚  â”‚
â”‚  â”‚  2. Create PostFX instance with all effects               â”‚  â”‚
â”‚  â”‚  3. Setup PostFXPanel with callbacks                      â”‚  â”‚
â”‚  â”‚  4. Connect callbacks to PostFX update methods            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Update Loop                             â”‚  â”‚
â”‚  â”‚  1. Update scene (particles, camera, lights)              â”‚  â”‚
â”‚  â”‚  2. Render via PostFX pipeline                            â”‚  â”‚
â”‚  â”‚  3. User adjusts panel â†’ callbacks fire â†’ uniforms update â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      PostFX (postfx.ts)                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Uniform Management                        â”‚  â”‚
â”‚  â”‚  â€¢ bloomUniforms        (enabled, threshold, strength...)  â”‚  â”‚
â”‚  â”‚  â€¢ caUniforms           (enabled, strength, radial...)     â”‚  â”‚
â”‚  â”‚  â€¢ lensUniforms         (enabled, distortion, vignette...) â”‚  â”‚
â”‚  â”‚  â€¢ colorGradeUniforms   (enabled, exposure, contrast...)   â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              TSL Effect Pipeline (GPU)                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  Step 1: MRT Scene Pass                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚  pass(scene, camera)                â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  â†’ output (scene color)             â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  â†’ bloomIntensity (per-object mask) â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                  â†“                                         â”‚  â”‚
â”‚  â”‚  Step 2: Advanced Bloom                                   â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚  1. Threshold extraction (bright)   â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  2. Multi-scale Kawase blur         â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚     â†’ Level 1: radius Ã— 1           â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚     â†’ Level 2: radius Ã— 2           â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚     â†’ Level 3: radius Ã— 3           â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  3. Weighted blend                  â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  4. Apply strength                  â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  5. Mask with bloomIntensity        â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  6. Additive blend to scene         â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                  â†“                                         â”‚  â”‚
â”‚  â”‚  Step 3: Chromatic Aberration                             â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚  1. Calculate radial distance       â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  2. Sample R channel (offset +)     â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  3. Sample G channel (offset 0)     â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  4. Sample B channel (offset -)     â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  5. Conditional blend (if enabled)  â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                  â†“                                         â”‚  â”‚
â”‚  â”‚  Step 4: Lens Distortion & Vignette                       â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚  1. Convert to polar coords         â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  2. Apply barrel/pincushion         â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  3. Sample distorted UV             â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  4. Calculate radial vignette       â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  5. Apply darkening                 â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  6. Conditional blend (if enabled)  â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                  â†“                                         â”‚  â”‚
â”‚  â”‚  Step 5: Color Grading                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚  1. Exposure adjustment             â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  2. Brightness shift                â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  3. Contrast around mid-gray        â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  4. Saturation (luminance-based)    â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  5. Temperature/tint shift          â”‚                 â”‚  â”‚
â”‚  â”‚  â”‚  6. Clamp to valid range            â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                  â†“                                         â”‚  â”‚
â”‚  â”‚  Step 6: Final Output                                     â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚  â”‚
â”‚  â”‚  â”‚  renderOutput() â†’ Screen            â”‚                 â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†‘                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                  Update Methods                            â”‚  â”‚
â”‚  â”‚  â€¢ updateBloom(config)                                    â”‚  â”‚
â”‚  â”‚  â€¢ updateChromaticAberration(config)                      â”‚  â”‚
â”‚  â”‚  â€¢ updateLensDistortion(config)                           â”‚  â”‚
â”‚  â”‚  â€¢ updateColorGrade(config)                               â”‚  â”‚
â”‚  â”‚  â†’ All modify uniforms in real-time                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†‘
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  PostFXPanel (PANELpostfx.ts)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                      UI Folders                            â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  âœ¨ Bloom                                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ enable          [x]                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ threshold       [â”â”â”â”â”â—‹â”â”â”â”] 0.70                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ strength        [â”â”â”â”â—‹â”â”â”â”â”] 0.80                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ radius          [â”â”â”â—‹â”â”â”â”â”â”] 1.00                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ quality         [â”â”â”â—‹â”â”â”â”â”â”] 3                        â”‚  â”‚
â”‚  â”‚  â””â”€ smoothing       [â”â—‹â”â”â”â”â”â”â”â”] 0.05                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸŒˆ Chromatic Aberration                                  â”‚  â”‚
â”‚  â”‚  â”œâ”€ enable          [ ]                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ strength        [â”â—‹â”â”â”â”â”â”â”â”] 0.003                    â”‚  â”‚
â”‚  â”‚  â””â”€ radial          [â”â”â”â”â”â—‹â”â”â”â”] 1.20                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ” Lens & Vignette                                       â”‚  â”‚
â”‚  â”‚  â”œâ”€ enable          [ ]                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ distortion      [â”â”â”â”â”â—‹â”â”â”â”] 0.00                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ vignette        [â”â”â—‹â”â”â”â”â”â”â”] 0.30                     â”‚  â”‚
â”‚  â”‚  â””â”€ v-radius        [â”â”â”â”â”â—‹â”â”â”â”] 1.00                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸ¨ Color Grade                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ enable          [x]                                   â”‚  â”‚
â”‚  â”‚  â”œâ”€ exposure        [â”â”â”â”â”â—‹â”â”â”â”] 1.00                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ contrast        [â”â”â”â”â”â—‹â”â”â”â”] 1.05                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ saturation      [â”â”â”â”â”â”â—‹â”â”â”] 1.10                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ brightness      [â”â”â”â”â”â—‹â”â”â”â”] 0.00                     â”‚  â”‚
â”‚  â”‚  â”œâ”€ temperature     [â”â”â”â”â”â—‹â”â”â”â”] 0.00                     â”‚  â”‚
â”‚  â”‚  â””â”€ tint            [â”â”â”â”â”â—‹â”â”â”â”] 0.00                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â”‚  ğŸŒ Environment                                           â”‚  â”‚
â”‚  â”‚  â”œâ”€ intensity       [â”â”â”â—‹â”â”â”â”â”â”] 0.50                     â”‚  â”‚
â”‚  â”‚  â””â”€ exposure        [â”â”â”â”â—‹â”â”â”â”â”] 0.66                     â”‚  â”‚
â”‚  â”‚                                                            â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                              â†“                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚                    Callbacks                               â”‚  â”‚
â”‚  â”‚  â€¢ onBloomChange                                          â”‚  â”‚
â”‚  â”‚  â€¢ onChromaticAberrationChange                            â”‚  â”‚
â”‚  â”‚  â€¢ onLensDistortionChange                                 â”‚  â”‚
â”‚  â”‚  â€¢ onColorGradeChange                                     â”‚  â”‚
â”‚  â”‚  â€¢ onEnvironmentChange                                    â”‚  â”‚
â”‚  â”‚  â†’ Fire on any slider/toggle change                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Effect Modules (TSL Nodes)                    â”‚
â”‚                                                                  â”‚
â”‚  kawaseblur.ts                                                  â”‚
â”‚  â”œâ”€ kawaseBlur(texture, direction, offset)                     â”‚
â”‚  â”‚  â€¢ Samples 4 texels in + pattern                            â”‚
â”‚  â”‚  â€¢ Separable (H/V passes)                                   â”‚
â”‚  â””â”€ kawaseBlurMultiPass(texture, iterations, scale)            â”‚
â”‚     â€¢ Multiple blur passes                                      â”‚
â”‚     â€¢ Exponential radius growth                                â”‚
â”‚                                                                  â”‚
â”‚  advancedbloom.ts                                               â”‚
â”‚  â”œâ”€ bloomThreshold(texture, threshold, smoothing)              â”‚
â”‚  â”‚  â€¢ Luminance calculation                                    â”‚
â”‚  â”‚  â€¢ Smooth knee threshold                                    â”‚
â”‚  â”œâ”€ advancedBloom(texture, threshold, strength, radius, levels)â”‚
â”‚  â”‚  â€¢ Multi-scale blur combination                             â”‚
â”‚  â”‚  â€¢ Weighted blending                                        â”‚
â”‚  â””â”€ bloomBlend(scene, bloom, strength)                         â”‚
â”‚     â€¢ Additive blend mode                                      â”‚
â”‚                                                                  â”‚
â”‚  chromaticaberration.ts                                         â”‚
â”‚  â””â”€ chromaticAberration(texture, strength, radialIntensity)    â”‚
â”‚     â€¢ Radial distance calculation                              â”‚
â”‚     â€¢ RGB channel separation                                   â”‚
â”‚     â€¢ Distance-based falloff                                   â”‚
â”‚                                                                  â”‚
â”‚  lensdistortion.ts                                              â”‚
â”‚  â”œâ”€ lensDistortion(texture, distortion, vigStr, vigRad)        â”‚
â”‚  â”‚  â€¢ Polar coordinate transform                               â”‚
â”‚  â”‚  â€¢ Barrel/pincushion effect                                 â”‚
â”‚  â”‚  â€¢ Radial vignette                                          â”‚
â”‚  â””â”€ vignette(texture, strength, radius)                        â”‚
â”‚     â€¢ Vignette only (no distortion)                            â”‚
â”‚                                                                  â”‚
â”‚  colorgrade.ts                                                  â”‚
â”‚  â””â”€ colorGrade(texture, exp, con, sat, bri, temp, tint)        â”‚
â”‚     â€¢ Exposure multiplication                                  â”‚
â”‚     â€¢ Brightness addition                                      â”‚
â”‚     â€¢ Contrast around mid-gray                                 â”‚
â”‚     â€¢ Saturation via luminance                                 â”‚
â”‚     â€¢ Temperature/tint RGB shifts                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow

```
User Interaction
      â†“
Panel Control Changed
      â†“
Callback Fired (PANELpostfx.ts)
      â†“
Update Method Called (postfx.ts)
      â†“
Uniform Value Changed (GPU memory)
      â†“
Next Frame Render
      â†“
TSL Shader Reads Uniform
      â†“
Effect Applied
      â†“
Screen Output
```

## Performance Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Scene Render   â”‚  Base: ~5-10ms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Bloom Pass     â”‚  +2.5ms (3 levels)
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Threshold  â”‚  â”‚  +0.2ms
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Blur L1    â”‚  â”‚  +0.8ms
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Blur L2    â”‚  â”‚  +0.8ms
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Blur L3    â”‚  â”‚  +0.8ms
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â†“        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Blend    â”‚  â”‚  +0.1ms
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Chromatic AB   â”‚  +0.1ms (when enabled)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Lens Distortion â”‚  +0.2ms (when enabled)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Color Grade    â”‚  +0.1ms
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      Output      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Post-FX: ~2.9ms
Total Frame: ~8-13ms
Target: 16.67ms (60fps) âœ“
        8.33ms (120fps) âœ“ (with headroom)
```

## Memory Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            GPU Memory                â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Uniform Buffers               â”‚ â”‚
â”‚  â”‚  â€¢ bloom (4 floats)            â”‚ â”‚
â”‚  â”‚  â€¢ chromaticAb (3 floats)      â”‚ â”‚
â”‚  â”‚  â€¢ lensDistortion (4 floats)   â”‚ â”‚
â”‚  â”‚  â€¢ colorGrade (7 floats)       â”‚ â”‚
â”‚  â”‚  Total: ~72 bytes              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Render Targets (MRT)          â”‚ â”‚
â”‚  â”‚  â€¢ output: RGBA16F             â”‚ â”‚
â”‚  â”‚  â€¢ bloomIntensity: R16F        â”‚ â”‚
â”‚  â”‚  Size: 1920Ã—1080Ã—6 bytes       â”‚ â”‚
â”‚  â”‚  Total: ~12.4 MB               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  Intermediate Textures         â”‚ â”‚
â”‚  â”‚  â€¢ Bloom blur passes           â”‚ â”‚
â”‚  â”‚  â€¢ Downsampled levels          â”‚ â”‚
â”‚  â”‚  Total: ~8-15 MB               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total GPU Memory: ~20-28 MB
```

## Configuration Flow

```
config.ts (defaultConfig)
      â†“
FlowApp.init() reads config
      â†“
PostFX constructor receives config
      â†“
Uniforms initialized with values
      â†“
PostFXPanel constructor receives config
      â†“
UI controls bound to config properties
      â†“
User changes control
      â†“
config property updated
      â†“
Callback fired with new config
      â†“
PostFX.updateX() method called
      â†“
Uniform.value updated
      â†“
GPU shader reads new value next frame
```

## Extensibility

Adding a new effect is simple:

1. Create `effects/neweffect.ts` with TSL node
2. Add config interface to `config.ts`
3. Add uniforms to `postfx.ts` constructor
4. Add effect to pipeline chain
5. Add update method to `postfx.ts`
6. Add controls to `PANELpostfx.ts`
7. Add callback to `APP.ts`

Each effect is isolated and composable!

---

**Architecture Highlights**:
- ğŸ¯ **Separation of Concerns** - Effects, pipeline, UI, config all isolated
- âš¡ **Performance** - Conditional rendering, single pass, GPU-optimized
- ğŸ”§ **Extensible** - Easy to add new effects
- ğŸ¨ **Flexible** - 20+ parameters for artistic control
- ğŸ“Š **Observable** - Real-time updates without rebuilds

